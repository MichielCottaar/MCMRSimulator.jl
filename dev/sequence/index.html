<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sequence · MCMRSimulator.jl</title><meta name="title" content="Sequence · MCMRSimulator.jl"/><meta property="og:title" content="Sequence · MCMRSimulator.jl"/><meta property="twitter:title" content="Sequence · MCMRSimulator.jl"/><meta name="description" content="Documentation for MCMRSimulator.jl: a Monte Carlo MRI simulator in Julia"/><meta property="og:description" content="Documentation for MCMRSimulator.jl: a Monte Carlo MRI simulator in Julia"/><meta property="twitter:description" content="Documentation for MCMRSimulator.jl: a Monte Carlo MRI simulator in Julia"/><meta property="og:url" content="https://open.win.ox.ac.uk/pages/ndcn0236/mcmrsimulator.jl/stable/sequence/"/><meta property="twitter:url" content="https://open.win.ox.ac.uk/pages/ndcn0236/mcmrsimulator.jl/stable/sequence/"/><link rel="canonical" href="https://open.win.ox.ac.uk/pages/ndcn0236/mcmrsimulator.jl/stable/sequence/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MCMRSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../tutorial_julia/">Tutorial (Julia)</a></li><li><a class="tocitem" href="../tutorial_cli/">Tutorial (CLI)</a></li><li><a class="tocitem" href="../geometry/">Geometry</a></li><li class="is-active"><a class="tocitem" href>Sequence</a><ul class="internal"><li><a class="tocitem" href="#Pulseseq-sequences"><span>Pulseseq sequences</span></a></li><li><a class="tocitem" href="#Built-in-MR-sequences"><span>Built-in MR sequences</span></a></li><li><a class="tocitem" href="#Custom-MR-sequences"><span>Custom MR sequences</span></a></li></ul></li><li><a class="tocitem" href="../properties/">MRI/collision properties</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Sequence</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Sequence</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://git.fmrib.ox.ac.uk/ndcn0236/MCMRSimulator.jl" title="View the repository"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">Repository</span></a><a class="docs-navbar-link" href="https://git.fmrib.ox.ac.uk/ndcn0236/MCMRSimulator.jl/-/tree/main/docs/src/sequence.md" title="Edit source"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="sequence"><a class="docs-heading-anchor" href="#sequence">MR sequences</a><a id="sequence-1"></a><a class="docs-heading-anchor-permalink" href="#sequence" title="Permalink"></a></h1><h2 id="Pulseseq-sequences"><a class="docs-heading-anchor" href="#Pulseseq-sequences">Pulseseq sequences</a><a id="Pulseseq-sequences-1"></a><a class="docs-heading-anchor-permalink" href="#Pulseseq-sequences" title="Permalink"></a></h2><p>Pulseq sequences can be generated using matlab (http://pulseq.github.io/) or python (https://pypulseq.readthedocs.io/en/master/). They can be loaded into MCMRSimulator using <a href="../api/#MCMRSimulator.Sequences.JSON.read_sequence-Tuple{IO}"><code>read_sequence</code></a>. On the command line they can be provided directly to any call of <code>mcmr run</code>, without calling <code>mcmr sequence</code> first. Developing your sequences in pulseq has the advantage that they can be used both in MCMRSimulator and on your MRI scanner.</p><h2 id="Built-in-MR-sequences"><a class="docs-heading-anchor" href="#Built-in-MR-sequences">Built-in MR sequences</a><a id="Built-in-MR-sequences-1"></a><a class="docs-heading-anchor-permalink" href="#Built-in-MR-sequences" title="Permalink"></a></h2><p>Simple <a href="../api/#MCMRSimulator.SequenceBuilder.Sequences.GradientEcho.gradient_echo-Tuple{Any}"><code>gradient_echo</code></a> and <a href="../api/#MCMRSimulator.SequenceBuilder.Sequences.SpinEcho.spin_echo-Tuple{Any}"><code>spin_echo</code></a> sequences are available. A pulsed-gradient spin-echo can be created using <a href="../api/#MCMRSimulator.SequenceBuilder.Sequences.SpinEcho.dwi-Tuple{}"><code>dwi</code></a>.</p><p>From the command line these sequences can be generated using <code>mcmr sequence gradient-echo/spin-echo/dwi</code>.</p><p>In Julia, one can use:</p><pre><code class="language-julia hljs">sequence = dwi(TR=100., bval=3.)</code></pre><p><img src="../dwi_sequence.png" alt="DWI sequence diagram"/></p><p>By setting the <code>gradient_duration</code> keyword to 0, <a href="../api/#MCMRSimulator.Sequences.Instants.InstantGradient"><code>InstantGradient</code></a> objects can be inserted instead of <a href="../api/#MCMRSimulator.Sequences.Gradients.MRGradients"><code>MRGradients</code></a>.</p><pre><code class="language-julia hljs">sequence = dwi(TR=100., bval=3., gradient_duration=0.)</code></pre><p><img src="../dwi_sequence_delta_0.png" alt="DWI sequence diagram with instanteneous gradients"/></p><h2 id="Custom-MR-sequences"><a class="docs-heading-anchor" href="#Custom-MR-sequences">Custom MR sequences</a><a id="Custom-MR-sequences-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-MR-sequences" title="Permalink"></a></h2><p>In MCMRSimulator.jl an MR <a href="../api/#MCMRSimulator.Sequences.Main.Sequence"><code>Sequence</code></a> describes the RF pulses and gradients applied by the MRI scanner.</p><p>This sequence contains of:</p><ul><li>RF pulses, which can be instantaneous (<a href="../api/#MCMRSimulator.Sequences.Instants.InstantRFPulse"><code>InstantRFPulse</code></a>) or be described more realistically as RF amplitude/phase profiles ([<code>RFPulse</code>])</li><li>Gradients. Like RF pulses they can be approximated as instanteneous (<a href="../api/#MCMRSimulator.Sequences.Instants.InstantGradient"><code>InstantGradient</code></a>) or have a finite duration (<a href="../api/#MCMRSimulator.Sequences.Gradients.MRGradients"><code>MRGradients</code></a>)</li><li>Readouts (<a href="../api/#MCMRSimulator.Sequences.Instants.Readout"><code>Readout</code></a>). These are always instanteneous as realistic modelling of an actual MRI readout would require modelling the whole brain and receiver coil configuration, which is far beyond the scope of this simulator.</li></ul><p>Each of these sequence components will play identically every repetition time (TR) of the sequence.</p><p>The simplest way to create these sequences is as a (possibly nested) vector of sequence <a href="../api/#MCMRSimulator.SequenceBuilder.BuildingBlocks.BuildingBlock"><code>BuildingBlock</code></a>, which are played in sequence.  Each building block can be one of the following:</p><ul><li>an RF pulse (<a href="../api/#MCMRSimulator.Sequences.Instants.InstantRFPulse"><code>InstantRFPulse</code></a> or finite <a href="../api/#MCMRSimulator.Sequences.RadioFrequency.RFPulse"><code>RFPulse</code></a>)</li><li>a gradient (<a href="../api/#MCMRSimulator.Sequences.Instants.InstantGradient"><code>InstantGradient</code></a> or finite <a href="../api/#MCMRSimulator.Sequences.Gradients.MRGradients"><code>MRGradients</code></a>)</li><li>a number indicating a delay</li><li>a <a href="../api/#MCMRSimulator.Sequences.Instants.Readout"><code>Readout</code></a></li><li>a <a href="../api/#MCMRSimulator.SequenceBuilder.BuildingBlocks.BuildingBlock"><code>BuildingBlock</code></a> object, which can be used for when an RF pulse and gradient need to played simultaneously (e.g., for slice-selective pulses)</li></ul><p>Such a (nested) vector can be passed on directly to the <a href="../api/#MCMRSimulator.Sequences.Main.Sequence"><code>Sequence</code></a> constructor.</p><p>Such custom sequences cannot be generated using the command line yet.</p><p>For example, a simple pulsed-gradient spin echo sequence could be generated in the following way (rather than call <a href="../api/#MCMRSimulator.SequenceBuilder.Sequences.SpinEcho.dwi-Tuple{}"><code>dwi</code></a>):</p><pre><code class="language-julia hljs">base_trapezium = MRGradients([
    (0, 0),
    (1, 0.01),  # 1 ms rise time to 0.01 kHz/um
    (39, 0.01), # constant amplitude for 38 ms
    (40, 0),    # total duration of 40 ms
])
trapezium = rotate_bvec(base_trapezium, [0, 1, 1])  # point +y/+z diagonal

sequence = Sequence([
    constant_pulse(2, 90),          # start with 2 ms excitation pulse
    trapezium,                      # followed immediated by MR gradients
    2,                              # wait for 2 ms
    constant_pulse(4, 180),         # refocus pulse (4 ms long)
    trapezium,
    3,
    Readout(),                      # Readout 90 ms after middle of excitation pulse
], TR=130, scanner=Scanner(B0=3.))</code></pre><p><img src="../custom_dwi.png" alt="Sequence diagram of custom DWI"/></p><p>Adding diffusion-weighting can be made easier using <a href="../api/#MCMRSimulator.SequenceBuilder.Diffusion.add_linear_diffusion_weighting-Tuple{Any, Any, Any}"><code>add_linear_diffusion_weighting</code></a>:</p><pre><code class="language-julia hljs"># Build sequence without diffusion weighting
base_sequence = [
    constant_pulse(2, 90),
    42,                      # to be replaced with gradient
    constant_pulse(4, 180),
    23,                      # to be replaced with gradient
    20,                      # kept empty to allow time for extended readout
    Readout(),
]
# replace blocks 2 and 4 in the `base_sequence` with gradients that produce a b-value of 1 um^2/ms
with_dwi = add_linear_diffusion_weighting(base_sequence, 2, 4, bval=1.)
sequence = Sequence(with_dwi; TR=100)</code></pre><p><img src="../custom_dwi_helped.png" alt="Sequence diagram of custom DWI using add_linear_diffusion_weighting"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../geometry/">« Geometry</a><a class="docs-footer-nextpage" href="../properties/">MRI/collision properties »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.1 on <span class="colophon-date" title="Friday 13 October 2023 17:47">Friday 13 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
